<!DOCTYPE html>
<html>
<head><link rel="stylesheet" href="styles/main.css"/></head>
<title> Pronunciation Gym </title>
<body>
    <nav class="slidemenu">
        <!-- Item 1 -->
        <input type="radio" name="slideItem" id="slide-item-1" class="slide-toggle"/>
        <label for="slide-item-1"><span onclick="window.location.href='gymnastics';">Gymnastics</span></label>

        <!-- Item 2 -->
        <input type="radio" name="slideItem" id="slide-item-2" class="slide-toggle" checked/>
        <label for="slide-item-2"><span onclick="window.location.href='statistics';">Statistics</span></label>

        <div class="clear"></div>
        <!-- Bar -->
        <div class="slider">
        <div class="bar"></div>
        </div>
    </nav>
    <div align="center" style="margin-top: 100px;">
        <div align="center" id="hard_word" style="width: 900px; height: 500px;"></div>
        <div align="center" id="word_time" style="width: 900px; height: 500px;"></div>
        <div align="center" id="word_count" style="width: 900px; height: 500px;"></div>
    </div>
</body>
<script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
<script type="text/javascript">
if (document.cookie !== "") {
    var user_id = document.cookie.split(" ")[1]
    google.charts.load('current', {'packages':['bar']});
    google.charts.setOnLoadCallback(getStats);
}

function getStats() {
    var xhr = new XMLHttpRequest();
    xhr.open("POST", "get_stats/" + String(user_id), true);
    xhr.setRequestHeader("Content-Type", "application/json");

    xhr.onreadystatechange = function () {
        if (xhr.readyState === 4 && xhr.status === 200) {
            var jsonContent = JSON.parse(xhr.responseText);
            console.log(jsonContent)
            draw_hard_word(jsonContent["word_stats"])
            draw_word_time(jsonContent["daily_stats"])
            draw_word_count(jsonContent["daily_stats"])
        }
    }
    xhr.send();
}

function draw_hard_word(word_list) {
    rows = [["Word", "Average Time"]]
    for (var i = 0; i < word_list.length; ++i) {
        row = word_list[i]
        row[1] = row[1]/1000
        rows.push(row)
    }

    var data = new google.visualization.arrayToDataTable(rows);

    var options = {
        width: 900,
        bars: 'horizontal', // Required for Material Bar Charts.
        axes: {
            x: {0: {side: 'top'}} // Top x-axis.
        },
        bar: { groupWidth: "90%" }
    };

    var chart = new google.charts.Bar(document.getElementById('hard_word'));
    chart.draw(data, options);
}

function draw_word_time(word_list) {
    rows = [["Date", "Time per Word"]]
    for (var i = 0; i < word_list.length; ++i) {
        row = word_list[i]
        rows.push([row[0], row[1]/1000])
    }

    var data = new google.visualization.arrayToDataTable(rows);

    var options = {
        title: "Difficult Words",
        width: 900,
        bars: 'vertical', // Required for Material Bar Charts.
        axes: {
            x: {0: {side: 'top'}} // Top x-axis.
        },
        bar: { groupWidth: "90%" }
    };

    var chart = new google.charts.Bar(document.getElementById('word_time'));
    chart.draw(data, options);
}

function draw_word_count(word_list) {
    rows = [["Date", "Word Count"]]
    for (var i = 0; i < word_list.length; ++i) {
        row = word_list[i]
        rows.push([row[0], row[2]])
    }

    var data = new google.visualization.arrayToDataTable(rows);

    var options = {
        title: "Difficult Words",
        width: 900,
        bars: 'vertical', // Required for Material Bar Charts.
        axes: {
            x: {0: {side: 'top'}} // Top x-axis.
        },
        bar: { groupWidth: "90%" }
    };

    var chart = new google.charts.Bar(document.getElementById('word_count'));
    chart.draw(data, options);
}
</script>
</html>
